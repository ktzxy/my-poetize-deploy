(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-68dde4fb"],{"65c6":function(t,e,n){},a325:function(t,e,n){"use strict";n.r(e);var s={components:{emoji:(n("d3b7"),n("3ca3"),n("ddb0"),n("b0c0"),n("498a"),n("caad"),n("2532"),n("ac1f"),n("1276"),function(){return n.e("chunk-b1d2b73c").then(n.bind(null,"da66"))}),proButton:function(){return n.e("chunk-94e299d0").then(n.bind(null,"ff66"))},uploadPicture:function(){return n.e("chunk-commons~31ecd969").then(n.bind(null,"6034"))},emojiPicker:function(){return Promise.all([n.e("chunk-commons~31ecd969"),n.e("chunk-3b7a6995")]).then(n.bind(null,"e38a"))}},props:{disableGraffiti:{type:Boolean,default:!1}},data:function(){return{commentContent:"",showEmoji:!1,showEmojiPicker:!1,showPicture:!1,picture:{name:this.$store.state.currentUser.username,url:""},showUserList:!1,mentionKeyword:"",filteredUsers:[],selectedUserIndex:0,mentionListStyle:{top:"0px",left:"0px"},mentionStartPos:0}},methods:{openPicture:function(){this.$common.isEmpty(this.$store.state.currentUser)?this.$message({message:"请先登录！",type:"error"}):this.showPicture=!0},addPicture:function(t){this.picture.url=t,this.savePicture()},savePicture:function(){var t="["+this.picture.name+","+this.picture.url+"]";this.commentContent+=t,this.picture.url="",this.showPicture=!1},addEmoji:function(t){var e=this.$refs.commentTextarea,n=e.selectionStart,s=e.selectionEnd,i=this.commentContent.substring(0,n),o=this.commentContent.substring(s);this.commentContent=i+t+o,this.$nextTick(function(){var s=n+t.length;e.setSelectionRange(s,s),e.focus()}),this.showEmoji=!1},insertEmoji:function(t){var e=this.$refs.commentTextarea,n=e.selectionStart,s=e.selectionEnd,i=this.commentContent.substring(0,n),o=this.commentContent.substring(s);this.commentContent=i+t+o,this.$nextTick(function(){var s=n+t.length;e.setSelectionRange(s,s),e.focus()})},toggleEmojiPicker:function(){this.showEmojiPicker=!this.showEmojiPicker},showGraffiti:function(){this.$common.isEmpty(this.$store.state.currentUser)?this.$message({message:"请先登录！",type:"error"}):(this.commentContent="",this.$emit("showGraffiti"))},submitComment:function(){this.$common.isEmpty(this.$store.state.currentUser)?this.$message({message:"请先登录！",type:"error"}):""!==this.commentContent.trim()?(this.$emit("submitComment",this.commentContent.trim()),this.commentContent=""):this.$message({message:"你还没写呢~",type:"warning"})},handleInput:function(t){var e=this.$refs.commentTextarea,n=e.selectionStart,s=this.commentContent.substring(0,n),i=s.lastIndexOf("@");if(-1!==i){var o=s.substring(i+1);if(!o.includes(" ")&&o.length<=20)return this.mentionKeyword=o,this.mentionStartPos=i,this.searchUsers(o),void this.updateMentionListPosition(e,n)}this.showUserList=!1},searchUsers:function(t){var e=this;if(0===t.length)return this.filteredUsers=[],this.showUserList=!0,void(this.selectedUserIndex=0);this.$http.get(this.$constant.baseURL+"/user/searchUserByName",{username:t}).then(function(t){t&&200===t.code&&(e.filteredUsers=t.data||[],e.showUserList=e.filteredUsers.length>0,e.selectedUserIndex=0)}).catch(function(){e.filteredUsers=[],e.showUserList=!1})},updateMentionListPosition:function(t,e){var n=this.commentContent.substring(0,e).split("\n").length;this.mentionListStyle={top:24*n+10+"px",left:"10px"}},selectUser:function(t){var e=this,n=this.commentContent.substring(0,this.mentionStartPos),s=this.commentContent.substring(this.mentionStartPos+this.mentionKeyword.length+1);this.commentContent=n+"@"+t.username+" "+s,this.showUserList=!1,this.mentionKeyword="",this.$nextTick(function(){e.$refs.commentTextarea.focus()})},handleKeydown:function(t){this.showUserList&&("ArrowUp"===t.key?(t.preventDefault(),this.selectedUserIndex=Math.max(0,this.selectedUserIndex-1)):"ArrowDown"===t.key?(t.preventDefault(),this.selectedUserIndex=Math.min(this.filteredUsers.length-1,this.selectedUserIndex+1)):"Enter"===t.key&&this.filteredUsers.length>0?(t.preventDefault(),this.selectUser(this.filteredUsers[this.selectedUserIndex])):"Escape"===t.key&&(this.showUserList=!1))}}},i=s,o=(n("e352"),n("2877")),r=Object(o.a)(i,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{position:"relative"}},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentContent,expression:"commentContent"}],ref:"commentTextarea",staticClass:"comment-textarea",attrs:{placeholder:"写下点什么...(@可以提及用户，点击表情图标添加表情)",maxlength:"1000"},domProps:{value:t.commentContent},on:{input:[function(e){e.target.composing||(t.commentContent=e.target.value)},t.handleInput],keydown:t.handleKeydown}}),n("div",{staticClass:"input-tip"},[n("span",{class:{"text-warning":t.commentContent.length>900}},[t._v(" "+t._s(t.commentContent.length)+"/1000 ")])]),t.showUserList?n("div",{staticClass:"mention-list",style:t.mentionListStyle},[t._l(t.filteredUsers,function(e,s){return n("div",{key:e.id,class:["mention-item",{active:t.selectedUserIndex===s}],on:{click:function(n){return t.selectUser(e)},mouseenter:function(e){t.selectedUserIndex=s}}},[n("el-avatar",{attrs:{size:24,src:e.avatar}}),n("span",{staticClass:"mention-username"},[t._v(t._s(e.username))])],1)}),0===t.filteredUsers.length?n("div",{staticClass:"mention-empty"},[t._v(" 未找到用户 ")]):t._e()],2):t._e()]),n("div",{staticClass:"myBetween",staticStyle:{"margin-bottom":"10px",position:"relative"}},[n("div",{staticStyle:{display:"flex"}},[n("div",{class:{"emoji-active":t.showEmojiPicker},staticStyle:{position:"relative"},on:{click:function(e){return e.stopPropagation(),t.toggleEmojiPicker.apply(null,arguments)}}},[n("i",{staticClass:"el-icon-orange myEmoji"}),n("emojiPicker",{attrs:{visible:t.showEmojiPicker},on:{"update:visible":function(e){t.showEmojiPicker=e},select:t.insertEmoji}})],1),n("div",{on:{click:function(e){return t.openPicture()}}},[n("i",{staticClass:"el-icon-picture myPicture"})])]),n("div",{staticStyle:{display:"flex"}},[n("proButton",{attrs:{info:"提交",before:t.$constant.before_color_2,after:t.$constant.after_color_2},nativeOn:{click:function(e){return t.submitComment()}}})],1)]),n("div",{staticClass:"emoji-wrapper"},[n("emoji",{attrs:{showEmoji:t.showEmoji},on:{addEmoji:t.addEmoji}})],1),n("el-dialog",{attrs:{title:"图片",visible:t.showPicture,width:"25%","append-to-body":!0,"close-on-click-modal":!1,"destroy-on-close":"",center:""},on:{"update:visible":function(e){t.showPicture=e}}},[n("div",[n("uploadPicture",{attrs:{prefix:"commentPicture",maxSize:2,maxNumber:1},on:{addPicture:t.addPicture}})],1)])],1)},[],!1,null,"a82400a6",null);e.default=r.exports},e352:function(t,e,n){"use strict";n("65c6")}}]);