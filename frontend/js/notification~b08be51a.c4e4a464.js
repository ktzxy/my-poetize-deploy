(window.webpackJsonp=window.webpackJsonp||[]).push([["notification~b08be51a"],{5063:function(t,i,a){},"75be":function(t,i,a){"use strict";a.r(i);var n=(a("4de4"),a("d3b7"),a("d81d"),a("159b"),a("c740"),a("a434"),{name:"Notification",data:function(){return{loading:!1,activeTab:"all",notifications:[],pagination:{current:1,size:10,total:0},tabs:[{type:"all",label:"全部",icon:"el-icon-message",count:0},{type:"comment",label:"评论回复",icon:"el-icon-chat-dot-round",count:0},{type:"like",label:"点赞",icon:"el-icon-star-on",count:0},{type:"follow",label:"关注",icon:"el-icon-user",count:0},{type:"system",label:"系统通知",icon:"el-icon-bell",count:0}]}},computed:{filteredNotifications:function(){var t=this;return"all"===this.activeTab?this.notifications:this.notifications.filter(function(i){return i.type===t.activeTab})},unreadCount:function(){return this.notifications.filter(function(t){return!t.isRead}).length},emptyText:function(){return{all:"暂无消息通知",comment:"暂无评论回复",like:"暂无点赞通知",follow:"暂无关注通知",system:"暂无系统通知"}[this.activeTab]||"暂无消息"}},created:function(){this.loadNotifications(),this.updateTabCounts()},methods:{loadNotifications:function(){var t=this;this.loading=!0;var i={current:this.pagination.current,size:this.pagination.size,type:"all"===this.activeTab?null:this.activeTab};this.$http.post(this.$constant.baseURL+"/webApi/notification/listNotifications",i).then(function(i){i&&200===i.code?i.data&&i.data.records&&(t.notifications=i.data.records.map(function(t){return{id:t.id,type:t.type,username:t.senderUsername||"系统",avatar:t.senderAvatar,content:t.content,extra:t.extra,linkUrl:t.linkUrl,isRead:t.isRead,createTime:t.createTime}}),t.pagination.total=i.data.total||0,t.updateTabCounts()):t.$message.error(i.message||"加载消息失败")}).catch(function(i){t.$message.error("加载消息失败")}).finally(function(){t.loading=!1})},updateTabCounts:function(){var t=this;this.tabs.forEach(function(i){"all"===i.type?i.count=t.unreadCount:i.count=t.notifications.filter(function(t){return t.type===i.type&&!t.isRead}).length})},changeTab:function(t){this.activeTab!==t&&(this.activeTab=t,this.pagination.current=1,this.loadNotifications())},getTypeLabel:function(t){return{comment:"评论",like:"点赞",follow:"关注",system:"系统"}[t]||""},handleNotificationClick:function(t){t.isRead||this.markAsRead(t),t.linkUrl&&this.$router.push(t.linkUrl)},markAsRead:function(t){var i=this;this.$http.post(this.$constant.baseURL+"/webApi/notification/markAsRead",{id:t.id}).then(function(a){a&&200===a.code?(t.isRead=!0,i.updateTabCounts(),i.$emit("update-unread-count",i.unreadCount)):i.$message.error(a.message||"操作失败")}).catch(function(t){i.$message.error("操作失败")})},markAllAsRead:function(){var t=this;this.$confirm("确定要将所有消息标记为已读吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){t.$http.post(t.$constant.baseURL+"/webApi/notification/markAllAsRead").then(function(i){i&&200===i.code?(t.notifications.forEach(function(t){t.isRead=!0}),t.updateTabCounts(),t.$message.success("已全部标记为已读")):t.$message.error(i.message||"操作失败")}).catch(function(i){t.$message.error("操作失败")})}).catch(function(){})},deleteNotification:function(t){var i=this;this.$confirm("确定要删除这条消息吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.$http.post(i.$constant.baseURL+"/webApi/notification/delete",{id:t.id}).then(function(a){if(a&&200===a.code){var n=i.notifications.findIndex(function(i){return i.id===t.id});n>-1&&i.notifications.splice(n,1),i.pagination.total--,i.updateTabCounts(),i.$message.success("删除成功")}else i.$message.error(a.message||"删除失败")}).catch(function(t){i.$message.error("删除失败")})}).catch(function(){})},clearAllNotifications:function(){var t=this;this.$confirm("确定要清空所有消息吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.post(t.$constant.baseURL+"/webApi/notification/clearAll").then(function(i){i&&200===i.code?(t.notifications=[],t.pagination.total=0,t.updateTabCounts(),t.$message.success("已清空所有消息")):t.$message.error(i.message||"清空失败")}).catch(function(i){t.$message.error("清空失败")})}).catch(function(){})},handlePageChange:function(t){this.pagination.current=t,this.loadNotifications(),window.scrollTo({top:0,behavior:"smooth"})}}}),e=n,o=(a("c865"),a("2877")),s=Object(o.a)(e,function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"notification-page"},[a("el-image",{staticClass:"background-image-notification",attrs:{lazy:"",src:t.$store.state.webInfo.backgroundImage,fit:"cover"}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"})]),a("div",{staticClass:"notification-container"},[a("div",{staticClass:"page-header"},[t._m(0),a("div",{staticClass:"header-actions"},[a("el-button",{attrs:{size:"small",type:"primary",disabled:0===t.unreadCount},on:{click:t.markAllAsRead}},[t._v(" 全部已读 ")]),a("el-button",{attrs:{size:"small",disabled:0===t.notifications.length},on:{click:t.clearAllNotifications}},[t._v(" 清空消息 ")])],1)]),a("div",{staticClass:"notification-tabs"},t._l(t.tabs,function(i){return a("div",{key:i.type,class:["tab-item",{"tab-active":t.activeTab===i.type}],on:{click:function(a){return t.changeTab(i.type)}}},[a("i",{class:i.icon}),a("span",[t._v(t._s(i.label))]),i.count>0?a("el-badge",{staticClass:"tab-badge",attrs:{value:i.count}}):t._e()],1)}),0),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"notification-list"},[t.filteredNotifications.length>0?a("div",t._l(t.filteredNotifications,function(i){return a("div",{key:i.id,class:["notification-item",{unread:!i.isRead}],on:{click:function(a){return t.handleNotificationClick(i)}}},[a("el-avatar",{staticClass:"notification-avatar",attrs:{size:50,src:i.avatar||t.$store.state.webInfo.avatar}}),a("div",{staticClass:"notification-content"},[a("div",{staticClass:"notification-header"},[a("div",{staticClass:"notification-user"},[a("span",{staticClass:"username"},[t._v(t._s(i.username))]),a("span",{staticClass:"notification-type-tag"},[t._v(t._s(t.getTypeLabel(i.type)))])]),a("div",{staticClass:"notification-time"},[t._v(t._s(t.$common.getDateDiff(i.createTime)))])]),a("div",{staticClass:"notification-message",domProps:{innerHTML:t._s(i.content)}}),i.extra?a("div",{staticClass:"notification-extra"},[t._v(' "'+t._s(i.extra)+'" ')]):t._e()]),a("div",{staticClass:"notification-actions"},[i.isRead?t._e():a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return a.stopPropagation(),t.markAsRead(i)}}},[t._v(" 标为已读 ")]),a("el-button",{staticClass:"delete-btn",attrs:{size:"mini",type:"text"},on:{click:function(a){return a.stopPropagation(),t.deleteNotification(i)}}},[t._v(" 删除 ")])],1)],1)}),0):a("div",{staticClass:"empty-notification"},[a("i",{staticClass:"el-icon-bell"}),a("p",[t._v(t._s(t.emptyText))])])]),t.filteredNotifications.length>0?a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":t.pagination.current,"page-size":t.pagination.size,total:t.pagination.total},on:{"current-change":t.handlePageChange}})],1):t._e()])],1)},[function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"header-title"},[a("i",{staticClass:"el-icon-bell"}),a("span",[t._v("消息通知中心")])])}],!1,null,"130b3b52",null);i.default=s.exports},c865:function(t,i,a){"use strict";a("5063")}}]);